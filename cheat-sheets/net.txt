Темы:
* host
* nslookup
* traceroute
* tcpdump
* ifconfig
* ping
* curl
* whois
* nmap
* IP route, Gateway, MAC
* Как закрыть порт
* robots.txt и sitemap.xml
* iwconfig


--- host
Возвращает информацю об узле Интернета, выполняя поиск с помощью службы DNS.
$ host case.moscow # вернет IP адрес


--- nslookup
Выполняет поиск имени узла Интернета по заданному IP.
$ nslookup 185.20.226.136 # вернет имя домена


--- traceroute
Утилита предназначенная для исследования топологии сети посредством передачи
ICMP пакетов удаленному узлу.

$ traceroute case.moscow -I
Параметр -I посылает ICMP пакеты, тем самым можно узнать весь процесс.

На каждый узел отправляется по три пакета и для каждого из них было засечено
время прохождения -> путь: туда и обратно. Когда `traceroute` выдает *** это
означает что информация недоступна.


--- tcpdump
Анализатор сетевого трафика, проанализировать сеть на уровне передаваемых
пакетов.

Разбор вывода
* Временная метка
* Протокол
* IP адрес отправителя
* IP адрес получателя
* Служебная информация
* Размер пакета в байтах

$ tcpdump -D                         # вывод сетевых интерфейсов
$ tcpdump -i eth0                    # захват трафика на интерфейсе eth0
$ tcpdump -i eth0 port 443           # анализ трафика по данному порту
$ tcpdump -i eth0 icmp               # анализ трафика по данному протоколу

$ tcpdump -i enp0s3 proto 1          # анализ трафика по протоколу, номер протокола /etc/protocols
1, 7, 17 основные - ICMP, TCP, UDP

$ tcpdump -i any                     # анализировать любой интерфейс


--- ifconfig
Параметры сети, настройка интерфейсов.

Настройка интерфейса, выполненные при помощи `ifconfig`, автоматически пропадают
при выключении ПК. После того как ядро Linux загружено опять, всю настройку
нужно выполнять снова. Обычно она производится автоматически специальными
скриптами при загрузке ПК.

`ifconfig` выводит интерфейсы, а это физические или виртуальные устройства,
предназначенные для передачи данных между программами через компьютерную сеть.
Сетевое взаимодейтсвие Linux-ПК происходит через сетевые интерфейсы. Любые
данные, которые ПК отправляет или получает происходит через эти сетевые
интерфейсы.

$ ifconfig <interface> up/down       # включить/отключить интерфейс
$ ifconfig -a                        # список всех интерфейсов, даже которые отключены

* Интерфейсы создаются автоматически для каждого обнаруженного сетевого
устройства при загрузке ядра OC. Чтобы устройство было доступно, необходимо
включить его драйвера в состав ядра.

lo (loopback) - возможность работы с TCP/IP, даже когда у нас нет
подключенных физических интерфейсов, адрес всегда 127.0.0.1 -> localhost
Нет связи с каким-либо оборудованием.

eth0 (Ethernet) - сетевой интерфейс к карте Ethernet.

wlan - сетевой интерфейс wi-fi адаптеров.

* Флаги (состояние интерфейса) - <UP, RUNNING>
UP - включен
BROADCAST - принимает широковещательные пакеты
MULTICAST - принимает групповые пакеты

* MTU - максимальный размер блока данных обрабатываемого интерфейсом.
По умолчанию равен 1500 байт, может повлиять на производительность сети, если у
роутера показатели MTU разные, то сетевой пакет будет разбит на меньший
показатель и если деление не будет равным, то к фрагменту будут добавлена
ненужная информация в виде балласта, MTU должны быть одинаковыми по провайдеру.

* Число принятых пакетов.
RX packets 127386  bytes 94305282 (89.9 MiB)

* Ошибки, отброшенные пакеты, переполненные.
RX errors 0  dropped 0  overruns 0  frame 0

Это MAC адрес:
ether 4c:cc:6a:b6:0a:0d


--- ping
Диагностика качества соединений TCP/IP.

PING означает (Packet Internet Groper).
Используется для проверки доступности удаленного хоста, отправляет пакеты на
хост и ждет ответа, если хост включен, должен быть ответ. Здесь используется
Echo Request (ICMP) сервер принимает запрос и отправляет эти же данные назад.

$ ping -c 5 google.com               # послать определенное кол-во запросов
$ ping -f google.com                 # flood запросов, простая DOS атака
$ ping case.moscow -l 1400           # отправить ping с размером пакета в 1400 байт

Проверка кол-во устройств в сети
$ echo 192.168.1.{1..254} | xargs -n1 -P0 ping -c1 | grep "bytes from"


--- curl
$ curl ftp://192.168.32.24/upload/main.gdb     # прочитать файл
$ curl -I https://fatal.website                # получить полный ответ HTTP
$ curl -o file ftp://192.168.32.24             # скачать в file с ftp
$ curl -T file ftp://192.168.32.24/upload      # отправить file на ftp
$ curl -O https://fatal.website/favicon.ico    # скачать файл, директории скачать нельзя


--- whois
Утилита с помощью которой можно узнать информацию о владельце сервера, домена и т.д.
$ whois case.moscow


--- nmap
Сканирует сетевые порты, обнаруживает хосты, MAC адреса, можно просканировать
локальную сеть.

$ nmap case.moscow
$ nmap -sn -PO 192.168.50.0/24       # подключенные хосты
$ nmap -A -v rserver                 # полный анализ, -A (OS detect), -v (verbose)


--- IP route, Gateway, MAC
Получение таблицы IP-маршрутизации ядра.
Здесь можно увдитеь Gateway.
$ ip r | grep "default"

Более подробный вывод шлюза + еще и MAC адрес.
$ arp -a


--- Как закрыть порт
Для начала нужно проверить какие порты открыты:
$ netstat -tulpn # состояние LISTEN.
или:
$ nmap localhost

Нужно удалить процесс/сервис, который открыл порт:
$ pkill vsftp

Или еще пример:
$ sudo lsof -i :80

Какой процесс (pid) использует порт 80, например, это nginx.

Для остановки сервиса, который использует порт 80:
$ sudo systemctl stop nginx

Отключить автозапуск сервиса:
$ sudo systemctl disable nginx


--- robots.txt и sitemap.xml
robots.txt содержит набор инструкций, поисковые роботы обрабатывает указанные URL.
Файл robots.txt используется прежде всего для управления трафиком поисковых
роботов на сайте. Как правило, с его помощью также можно исключить контент из
результатов поиска.

User-agent: Yandex
Disallow: catalog/
Allow: /catalog/cucumbers/
Sitemap: http://www.example.com/sitemap.xml

User-agent  название робота, к которому применяется правило
Disallow    не будут индексироваться
Allow       можно сканировать
Sitemap     структура сайта (помогает роботам индексировать страницы)

$ wget -r -l0 https://gplaycards.com/
-r - рекурсивно
-l - глубина скачивания

Удалось получить содержимое сайта и всех его ссылок, к сожалению robots.txt не
было, sitemap.xml тоже не было, это говорит, что сайт распространяется прямой
ссылкой (сайт-визитница), Google-роботы и Yandex о нем ничего не знают.

Еще можно проверить доступ к панели-администрирования /admin /login и подобные адреса.


--- iwconfig
Инструмент для работы с wi-fi сетями.
Можно посмотреть диапазон сети 2,4ггц или 5ггц.
$ iwconfig
